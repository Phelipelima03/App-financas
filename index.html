<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>MetaCartão – HTML</title>

<style>
:root{
  --bg:#0b0d12;
  --panel:#121622;
  --text:#e8eefc;
  --muted:#aab4d6;
  --line:rgba(255,255,255,.08);
  --shadow:0 10px 30px rgba(0,0,0,.35);
  --blue:#5bc0ff;
  --red:#ff5b5b;
  --green:#35d07f;
  --orange:#ffb347;
  --purple:#b58bff;
  --chip:#1a2032;
}
*{box-sizing:border-box}
body{
  margin:0;
  background:#0b0d12;
  color:var(--text);
  font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;
}
.app{max-width:1100px;margin:auto;padding:16px}
h1,h2,h3,p{margin:0}
button,input{font-family:inherit}

.btn{
  border:0;border-radius:12px;padding:10px 14px;
  font-weight:700;cursor:pointer
}
.btnGreen{background:var(--green)}
.btnRed{background:var(--red)}
.btnOrange{background:var(--orange)}
.btnGhost{background:#222;color:#fff;border:1px solid var(--line)}
.btnDark{background:#111;color:#fff}

.panel{
  background:var(--panel);
  border:1px solid var(--line);
  border-radius:14px;
  margin-bottom:16px;
}
.panelHeader{
  padding:12px;border-bottom:1px solid var(--line);
  display:flex;justify-content:space-between;align-items:center
}
.panelBody{padding:12px}

.tabs{display:grid;grid-template-columns:repeat(5,1fr);gap:8px;margin-bottom:16px}
.tab{padding:12px;border-radius:12px;font-weight:800;cursor:pointer}
.tabDash{background:var(--blue)}
.tabGastos{background:var(--red)}
.tabFixas{background:var(--green)}
.tabRec{background:var(--orange)}
.tabCards{background:var(--purple)}

.item{
  background:#1a2032;border:1px solid var(--line);
  border-radius:12px;padding:10px;margin-bottom:10px
}
.row{display:flex;gap:8px;flex-wrap:wrap;align-items:center}
.muted{color:var(--muted)}
input{width:100%;padding:8px;border-radius:8px;border:1px solid var(--line);background:#111;color:#fff}
</style>
</head>

<body>
<div class="app">
  <h1>MetaCartão</h1>
  <p class="muted">Controle financeiro mensal • fixas automáticas</p>

  <div class="tabs">
    <div class="tab tabDash" onclick="go('dashboard')">Dashboard</div>
    <div class="tab tabGastos" onclick="go('gastos')">Gastos</div>
    <div class="tab tabFixas" onclick="go('fixas')">Fixas</div>
    <div class="tab tabRec" onclick="go('receitas')">Receitas</div>
    <div class="tab tabCards" onclick="go('cartoes')">Cartões</div>
  </div>

  <div id="view"></div>
</div>

<script>
const STORAGE="metacartao_v2";

const DEFAULT_CARDS={
  "Mercado Pago":400,"Caixa":400,"Magalu":400,"BrB":400,"Nubank":0,"Inter":0
};

const DEFAULT_FIXAS=[
 {id:crypto.randomUUID(),name:"Aluguel",amount:280},
 {id:crypto.randomUUID(),name:"Luz",amount:450},
 {id:crypto.randomUUID(),name:"Água",amount:380},
 {id:crypto.randomUUID(),name:"Internet",amount:33.33},
 {id:crypto.randomUUID(),name:"Gás",amount:120},
];

function seed(){
 return{
  cards:{...DEFAULT_CARDS},
  fixed_templates:[...DEFAULT_FIXAS],
  transactions:[],
  incomes:[]
 };
}

function load(){
 try{return JSON.parse(localStorage.getItem(STORAGE))||seed()}
 catch{return seed()}
}
function save(){localStorage.setItem(STORAGE,JSON.stringify(data))}

let data=load();
let now=new Date();
let state={route:"dashboard",m:now.getMonth()+1,y:now.getFullYear()};

function brl(v){return Number(v).toLocaleString("pt-BR",{style:"currency",currency:"BRL"})}

function fmt(d){
 return String(d.getDate()).padStart(2,"0")+"/"+String(d.getMonth()+1).padStart(2,"0")+"/"+d.getFullYear()
}
function sameMonth(d){return d.getMonth()+1===state.m&&d.getFullYear()===state.y}

function ensureFixas(){
 data.fixed_templates.forEach(f=>{
  const tag="[FIXA:"+f.id+"]";
  let tx=data.transactions.find(t=>t.desc?.startsWith(tag)&&sameMonth(new Date(t.date.split("/").reverse().join("-"))));
  if(!tx){
   data.transactions.push({
    date:"01/"+String(state.m).padStart(2,"0")+"/"+state.y,
    valor:f.amount,
    cat:"Despesas Fixas",
    card:"Mercado Pago",
    desc:`[FIXA:${f.id}] ${f.name}`,
    paid:false
   });
  }else{
   tx.valor=f.amount;
   tx.desc=`[FIXA:${f.id}] ${f.name}`;
  }
 });
 save();
}

function go(r){state.route=r;render()}

function render(){
 ensureFixas();
 const v=document.getElementById("view");
 v.innerHTML="";
 if(state.route==="dashboard")renderDashboard(v);
 if(state.route==="gastos")renderGastos(v);
 if(state.route==="fixas")renderFixas(v);
 if(state.route==="receitas")renderReceitas(v);
 if(state.route==="cartoes")renderCartoes(v);
}

function renderDashboard(v){
 const inc=data.incomes.reduce((a,i)=>sameMonth(new Date(i.date.split("/").reverse().join("-")))?a+i.valor:a,0);
 const exp=data.transactions.reduce((a,t)=>sameMonth(new Date(t.date.split("/").reverse().join("-")))?a+t.valor:a,0);
 v.innerHTML=`
 <div class="panel">
  <div class="panelHeader"><b>Resumo do mês</b></div>
  <div class="panelBody">
   <p>Receitas: <b>${brl(inc)}</b></p>
   <p>Despesas: <b>${brl(exp)}</b></p>
   <p>Saldo: <b>${brl(inc-exp)}</b></p>
  </div>
 </div>`;
}

function renderGastos(v){
 let html=`<div class="panel"><div class="panelHeader"><b>Gastos</b></div><div class="panelBody">`;
 data.transactions.filter(t=>sameMonth(new Date(t.date.split("/").reverse().join("-")))).forEach(t=>{
  html+=`
  <div class="item">
   <b>${t.desc}</b>
   <p>${brl(t.valor)} • ${t.paid?"Pago":"Pendente"}</p>
   <button class="btn ${t.paid?"btnRed":"btnGreen"}" onclick="togg('${t.desc}')">
    ${t.paid?"Marcar pagar":"Marcar pago"}
   </button>
  </div>`;
 });
 html+=`</div></div>`;
 v.innerHTML=html;
}

function togg(desc){
 const t=data.transactions.find(x=>x.desc===desc);
 if(t)t.paid=!t.paid;
 save();render();
}

function renderFixas(v){
 let html=`<div class="panel"><div class="panelHeader">
 <b>Fixas (editáveis)</b>
 <button class="btn btnGreen" onclick="addFixa()">+ Nova</button>
 </div><div class="panelBody">`;
 data.fixed_templates.forEach(f=>{
  html+=`
  <div class="item">
   <input value="${f.name}" onchange="editFixa('${f.id}',this.value,null)">
   <input value="${f.amount}" onchange="editFixa('${f.id}',null,this.value)">
   <button class="btn btnGhost" onclick="delFixa('${f.id}')">Excluir</button>
  </div>`;
 });
 html+=`</div></div>`;
 v.innerHTML=html;
}

function addFixa(){
 data.fixed_templates.push({id:crypto.randomUUID(),name:"Nova fixa",amount:0});
 save();render();
}
function editFixa(id,name,val){
 const f=data.fixed_templates.find(x=>x.id===id);
 if(name!==null)f.name=name;
 if(val!==null)f.amount=Number(val);
 save();render();
}
function delFixa(id){
 data.fixed_templates=data.fixed_templates.filter(f=>f.id!==id);
 data.transactions=data.transactions.filter(t=>!t.desc.startsWith("[FIXA:"+id+"]"));
 save();render();
}

function renderReceitas(v){
 let html=`<div class="panel"><div class="panelHeader">
 <b>Receitas</b>
 <button class="btn btnOrange" onclick="addRec()">+ Receita</button>
 </div><div class="panelBody">`;
 data.incomes.forEach(i=>{
  html+=`<div class="item">${i.date} • ${brl(i.valor)}</div>`;
 });
 html+=`</div></div>`;
 v.innerHTML=html;
}

function addRec(){
 const v=prompt("Valor da receita:");
 if(!v)return;
 data.incomes.push({date:fmt(new Date()),valor:Number(v)});
 save();render();
}

function renderCartoes(v){
 let html=`<div class="panel"><div class="panelHeader"><b>Cartões</b></div><div class="panelBody">`;
 Object.entries(data.cards).forEach(([c,l])=>{
  const g=data.transactions.filter(t=>t.card===c&&sameMonth(new Date(t.date.split("/").reverse().join("-"))))
    .reduce((a,t)=>a+t.valor,0);
  html+=`<div class="item">${c}: ${brl(g)} / ${brl(l)}</div>`;
 });
 html+=`</div></div>`;
 v.innerHTML=html;
}

render();
</script>
</body>
</html>
